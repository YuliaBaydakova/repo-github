{"paragraphs":[{"text":"%pyspark\nfrom pyspark.sql import SparkSession\n\nspark = SparkSession \\\n    .builder \\\n    .appName(\"lesson_7\") \\\n    .getOrCreate()","user":"anonymous","dateUpdated":"2022-10-04T16:06:27+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","tableHide":false,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1664869498132_-861567435","id":"20221004-074458_155874434","dateCreated":"2022-10-04T07:44:58+0000","dateStarted":"2022-10-04T16:06:27+0000","dateFinished":"2022-10-04T16:06:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:10094"},{"text":"%pyspark\n#прочитали файл по ссылке\nurl = 'https://s3.amazonaws.com/apache-zeppelin/tutorial/bank/bank.csv'\nfrom pyspark import SparkFiles\nspark.sparkContext.addFile(url)","user":"anonymous","dateUpdated":"2022-10-04T16:06:28+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","tableHide":false,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1664878957151_393593130","id":"20221004-102237_740314168","dateCreated":"2022-10-04T10:22:37+0000","dateStarted":"2022-10-04T16:06:28+0000","dateFinished":"2022-10-04T16:06:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:10095"},{"text":"%pyspark\n#прочитали данные из файла\ndata = spark.read.csv(\"file://\"+SparkFiles.get(\"bank.csv\"), sep=';', header=True, inferSchema = True)\ndata.show()","user":"anonymous","dateUpdated":"2022-10-04T16:06:29+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","tableHide":false,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---+-------------+-------+---------+-------+-------+-------+----+--------+---+-----+--------+--------+-----+--------+--------+---+\n|age|          job|marital|education|default|balance|housing|loan| contact|day|month|duration|campaign|pdays|previous|poutcome|  y|\n+---+-------------+-------+---------+-------+-------+-------+----+--------+---+-----+--------+--------+-----+--------+--------+---+\n| 30|   unemployed|married|  primary|     no|   1787|     no|  no|cellular| 19|  oct|      79|       1|   -1|       0| unknown| no|\n| 33|     services|married|secondary|     no|   4789|    yes| yes|cellular| 11|  may|     220|       1|  339|       4| failure| no|\n| 35|   management| single| tertiary|     no|   1350|    yes|  no|cellular| 16|  apr|     185|       1|  330|       1| failure| no|\n| 30|   management|married| tertiary|     no|   1476|    yes| yes| unknown|  3|  jun|     199|       4|   -1|       0| unknown| no|\n| 59|  blue-collar|married|secondary|     no|      0|    yes|  no| unknown|  5|  may|     226|       1|   -1|       0| unknown| no|\n| 35|   management| single| tertiary|     no|    747|     no|  no|cellular| 23|  feb|     141|       2|  176|       3| failure| no|\n| 36|self-employed|married| tertiary|     no|    307|    yes|  no|cellular| 14|  may|     341|       1|  330|       2|   other| no|\n| 39|   technician|married|secondary|     no|    147|    yes|  no|cellular|  6|  may|     151|       2|   -1|       0| unknown| no|\n| 41| entrepreneur|married| tertiary|     no|    221|    yes|  no| unknown| 14|  may|      57|       2|   -1|       0| unknown| no|\n| 43|     services|married|  primary|     no|    -88|    yes| yes|cellular| 17|  apr|     313|       1|  147|       2| failure| no|\n| 39|     services|married|secondary|     no|   9374|    yes|  no| unknown| 20|  may|     273|       1|   -1|       0| unknown| no|\n| 43|       admin.|married|secondary|     no|    264|    yes|  no|cellular| 17|  apr|     113|       2|   -1|       0| unknown| no|\n| 36|   technician|married| tertiary|     no|   1109|     no|  no|cellular| 13|  aug|     328|       2|   -1|       0| unknown| no|\n| 20|      student| single|secondary|     no|    502|     no|  no|cellular| 30|  apr|     261|       1|   -1|       0| unknown|yes|\n| 31|  blue-collar|married|secondary|     no|    360|    yes| yes|cellular| 29|  jan|      89|       1|  241|       1| failure| no|\n| 40|   management|married| tertiary|     no|    194|     no| yes|cellular| 29|  aug|     189|       2|   -1|       0| unknown| no|\n| 56|   technician|married|secondary|     no|   4073|     no|  no|cellular| 27|  aug|     239|       5|   -1|       0| unknown| no|\n| 37|       admin.| single| tertiary|     no|   2317|    yes|  no|cellular| 20|  apr|     114|       1|  152|       2| failure| no|\n| 25|  blue-collar| single|  primary|     no|   -221|    yes|  no| unknown| 23|  may|     250|       1|   -1|       0| unknown| no|\n| 31|     services|married|secondary|     no|    132|     no|  no|cellular|  7|  jul|     148|       1|  152|       1|   other| no|\n+---+-------------+-------+---------+-------+-------+-------+----+--------+---+-----+--------+--------+-----+--------+--------+---+\nonly showing top 20 rows\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=181","http://172.17.0.2:4040/jobs/job?id=182","http://172.17.0.2:4040/jobs/job?id=183"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1664881742350_261756628","id":"20221004-110902_87581884","dateCreated":"2022-10-04T11:09:02+0000","dateStarted":"2022-10-04T16:06:30+0000","dateFinished":"2022-10-04T16:06:30+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:10096"},{"text":"%pyspark\n#уменьшили данные до трех столбцов и создали окна относительно которых буду работать оконные функции, посчитали длину фрейма данных\nfrom pyspark.sql.window import Window\ndf = data['job','age','balance']\nw = Window.partitionBy('job').orderBy('age')\nw_empty = Window.partitionBy().orderBy('age')\ndf.show(5)","user":"anonymous","dateUpdated":"2022-10-04T16:06:32+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","tableHide":false,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------+---+-------+\n|        job|age|balance|\n+-----------+---+-------+\n| unemployed| 30|   1787|\n|   services| 33|   4789|\n| management| 35|   1350|\n| management| 30|   1476|\n|blue-collar| 59|      0|\n+-----------+---+-------+\nonly showing top 5 rows\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=184"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1664881795075_-2005496754","id":"20221004-110955_863994006","dateCreated":"2022-10-04T11:09:55+0000","dateStarted":"2022-10-04T16:06:32+0000","dateFinished":"2022-10-04T16:06:32+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:10097"},{"text":"%pyspark\n#посмотрели на результат работы оконных функций\nimport pyspark.sql.functions as F\n\n(\n    df\n    .withColumn('row_number', F.row_number().over(w))\n    .withColumn('rank', F.rank().over(w))\n    .withColumn('dense_rank', F.dense_rank().over(w))\n    .withColumn('ntile_4000', F.ntile(4000).over(w_empty))\n    .withColumn('lag', F.lag('balance',1).over(w_empty))\n    .withColumn('lead', F.lead('balance',2).over(w_empty))\n    .withColumn('cume_dist', F.cume_dist().over(w_empty))\n).show()\n","user":"anonymous","dateUpdated":"2022-10-04T16:06:35+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","tableHide":false,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+---+-------+----------+----+----------+----------+----+----+--------------------+\n|     job|age|balance|row_number|rank|dense_rank|ntile_4000| lag|lead|           cume_dist|\n+--------+---+-------+----------+----+----------+----------+----+----+--------------------+\n| student| 19|    103|         1|   1|         1|         1|null| 302|8.847600088476001E-4|\n| student| 19|      0|         2|   1|         1|         1| 103|1169|8.847600088476001E-4|\n| student| 19|    302|         3|   1|         1|         2|   0| 502|8.847600088476001E-4|\n| student| 19|   1169|         4|   1|         1|         2| 302| 291|8.847600088476001E-4|\n| student| 20|    502|         5|   5|         2|         3|1169|1191|  0.0015483300154833|\n| student| 20|    291|         6|   5|         2|         3| 502|2488|  0.0015483300154833|\n| student| 20|   1191|         7|   5|         2|         4| 291| 681|  0.0015483300154833|\n| student| 21|   2488|         8|   8|         3|         4|1191| 137|  0.0030966600309666|\n| student| 21|    681|         9|   8|         3|         5|2488|   6|  0.0030966600309666|\n| student| 21|    137|        10|   8|         3|         5| 681|6844|  0.0030966600309666|\n| student| 21|      6|        11|   8|         3|         6| 137| 361|  0.0030966600309666|\n| student| 21|   6844|        12|   8|         3|         6|   6|1903|  0.0030966600309666|\n|services| 21|    361|         1|   1|         1|         7|6844|1161|  0.0030966600309666|\n|services| 21|   1903|         2|   1|         1|         7| 361| 549|  0.0030966600309666|\n| student| 22|   1161|        13|  13|         4|         8|1903|  47|  0.0050873700508737|\n| student| 22|    549|        14|  13|         4|         8|1161|3472|  0.0050873700508737|\n| student| 22|     47|        15|  13|         4|         9| 549|2488|  0.0050873700508737|\n| student| 22|   3472|        16|  13|         4|         9|  47| 691|  0.0050873700508737|\n| student| 22|   2488|        17|  13|         4|        10|3472| 246|  0.0050873700508737|\n| student| 22|    691|        18|  13|         4|        10|2488|4111|  0.0050873700508737|\n+--------+---+-------+----------+----+----------+----------+----+----+--------------------+\nonly showing top 20 rows\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://172.17.0.2:4040/jobs/job?id=185"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1664881917574_-242691810","id":"20221004-111157_1268511823","dateCreated":"2022-10-04T11:11:57+0000","dateStarted":"2022-10-04T16:06:35+0000","dateFinished":"2022-10-04T16:06:37+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:10098"},{"text":"%sh\nls /data/","user":"anonymous","dateUpdated":"2022-10-04T16:06:40+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1664898103943_2063528364","id":"20221004-154143_1893738312","dateCreated":"2022-10-04T15:41:43+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:11086","dateFinished":"2022-10-04T16:06:40+0000","dateStarted":"2022-10-04T16:06:40+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"bank.csv\nbank-full.csv\nbank-names.txt\nbank.zip\nitems.csv\nseeds_dataset.csv\n"}]}},{"text":"%python\nimport pandas as pd\npath = '/data/seeds_dataset.csv'\ndf = pd.read_csv(path, sep=';', header = 0, usecols = [0,1,2,3])\ndf.head(3)","user":"anonymous","dateUpdated":"2022-10-04T16:06:42+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","tableHide":false,"editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1664869604222_1308565671","id":"20221004-074644_1621759553","dateCreated":"2022-10-04T07:46:44+0000","dateStarted":"2022-10-04T16:06:42+0000","dateFinished":"2022-10-04T16:06:42+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:10099","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"   Площадь  Периметр  Компакность  Длина ядра\n0    15.26     14.84       0.8710       5.763\n1    14.88     14.57       0.8811       5.554\n2    14.29     14.09       0.9050       5.291"}]}},{"text":"%python\ndf['смещ_периметр'] = df['Периметр'].shift(1)\ndf","user":"anonymous","dateUpdated":"2022-10-04T16:06:46+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","tableHide":false,"editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1664869703136_1456592599","id":"20221004-074823_1118286052","dateCreated":"2022-10-04T07:48:23+0000","dateStarted":"2022-10-04T16:06:46+0000","dateFinished":"2022-10-04T16:06:46+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:10100","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"     Площадь  Периметр  Компакность  Длина ядра  смещ_периметр\n0      15.26     14.84       0.8710       5.763            NaN\n1      14.88     14.57       0.8811       5.554          14.84\n2      14.29     14.09       0.9050       5.291          14.57\n3      13.84     13.94       0.8955       5.324          14.09\n4      16.14     14.99       0.9034       5.658          13.94\n5      14.38     14.21       0.8951       5.386          14.99\n6      14.69     14.49       0.8799       5.563          14.21\n7      14.11     14.10       0.8911       5.420          14.49\n8      16.63     15.46       0.8747       6.053          14.10\n9      16.44     15.25       0.8880       5.884          15.46\n10     15.26     14.85       0.8696       5.714          15.25\n11     14.03     14.16       0.8796       5.438          14.85\n12     13.89     14.02       0.8880       5.439          14.16\n13     13.78     14.06       0.8759       5.479          14.02\n14     13.74     14.05       0.8744       5.482          14.06\n15     14.59     14.28       0.8993       5.351          14.05\n16     13.99     13.83       0.9183       5.119          14.28\n17     15.69     14.75       0.9058       5.527          13.83\n18     14.70     14.21       0.9153       5.205          14.75\n19     12.72     13.57       0.8686       5.226          14.21\n20     14.16     14.40       0.8584       5.658          13.57\n21     14.11     14.26       0.8722       5.520          14.40\n22     15.88     14.90       0.8988       5.618          14.26\n23     12.08     13.23       0.8664       5.099          14.90\n24     15.01     14.76       0.8657       5.789          13.23\n25     16.19     15.16       0.8849       5.833          14.76\n26     13.02     13.76       0.8641       5.395          15.16\n27     12.74     13.67       0.8564       5.395          13.76\n28     14.11     14.18       0.8820       5.541          13.67\n29     13.45     14.02       0.8604       5.516          14.18\n..       ...       ...          ...         ...            ...\n180    11.41     12.95       0.8560       5.090          13.47\n181    12.46     13.41       0.8706       5.236          12.95\n182    12.19     13.36       0.8579       5.240          13.41\n183    11.65     13.07       0.8575       5.108          13.36\n184    12.89     13.77       0.8541       5.495          13.07\n185    11.56     13.31       0.8198       5.363          13.77\n186    11.81     13.45       0.8198       5.413          13.31\n187    10.91     12.80       0.8372       5.088          13.45\n188    11.23     12.82       0.8594       5.089          12.80\n189    10.59     12.41       0.8648       4.899          12.82\n190    10.93     12.80       0.8390       5.046          12.41\n191    11.27     12.86       0.8563       5.091          12.80\n192    11.87     13.02       0.8795       5.132          12.86\n193    10.82     12.83       0.8256       5.180          13.02\n194    12.11     13.27       0.8639       5.236          12.83\n195    12.80     13.47       0.8860       5.160          13.27\n196    12.79     13.53       0.8786       5.224          13.47\n197    13.37     13.78       0.8849       5.320          13.53\n198    12.62     13.67       0.8481       5.410          13.78\n199    12.76     13.38       0.8964       5.073          13.67\n200    12.38     13.44       0.8609       5.219          13.38\n201    12.67     13.32       0.8977       4.984          13.44\n202    11.18     12.72       0.8680       5.009          13.32\n203    12.70     13.41       0.8874       5.183          12.72\n204    12.37     13.47       0.8567       5.204          13.41\n205    12.19     13.20       0.8783       5.137          13.47\n206    11.23     12.88       0.8511       5.140          13.20\n207    13.20     13.66       0.8883       5.236          12.88\n208    11.84     13.21       0.8521       5.175          13.66\n209    12.30     13.34       0.8684       5.243          13.21\n\n[210 rows x 5 columns]"}]}},{"text":"%python\ndf['delta'] = df['Периметр'] - df['смещ_периметр']\ndf[['Периметр','смещ_периметр','delta']].head(4)","user":"anonymous","dateUpdated":"2022-10-04T16:07:38+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","tableHide":false,"editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1664869776756_83445058","id":"20221004-074936_977697403","dateCreated":"2022-10-04T07:49:36+0000","dateStarted":"2022-10-04T16:07:38+0000","dateFinished":"2022-10-04T16:07:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:10101","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"   Периметр  смещ_периметр  delta\n0     14.84            NaN    NaN\n1     14.57          14.84  -0.27\n2     14.09          14.57  -0.48\n3     13.94          14.09  -0.15"}]}},{"text":"%python\ndf['expand'] = df['Длина ядра'].expanding().sum()\ndf[['Длина ядра','expand']].head(4)","user":"anonymous","dateUpdated":"2022-10-04T16:08:04+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","tableHide":false,"editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1664870517396_-1274087375","id":"20221004-080157_1880147746","dateCreated":"2022-10-04T08:01:57+0000","dateStarted":"2022-10-04T16:08:04+0000","dateFinished":"2022-10-04T16:08:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:10102","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"   Длина ядра  expand\n0       5.763   5.763\n1       5.554  11.317\n2       5.291  16.608\n3       5.324  21.932"}]}},{"text":"%python\ndf['rolling'] = df['Длина ядра'].rolling(3).mean()\ndf[['Длина ядра','expand','rolling']].head(5)","user":"anonymous","dateUpdated":"2022-10-04T16:08:08+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","tableHide":false,"editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1664870618038_1811928649","id":"20221004-080338_1103863210","dateCreated":"2022-10-04T08:03:38+0000","dateStarted":"2022-10-04T16:08:08+0000","dateFinished":"2022-10-04T16:08:08+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:10103","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"   Длина ядра  expand   rolling\n0       5.763   5.763       NaN\n1       5.554  11.317       NaN\n2       5.291  16.608  5.536000\n3       5.324  21.932  5.389667\n4       5.658  27.590  5.424333"}]}}],"name":"Spark_HW7","id":"2HECA72H7","noteParams":{},"noteForms":{},"angularObjects":{"python:shared_process":[],"sh:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}